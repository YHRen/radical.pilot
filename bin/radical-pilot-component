#!/usr/bin/env python

__copyright__ = "Copyright 2014-2016, http://radical.rutgers.edu"
__license__   = "MIT"


import os
import sys

import setproctitle        as spt
import radical.utils       as ru
import radical.pilot.utils as rpu


# ------------------------------------------------------------------------------
#
if __name__ == "__main__":

    if len(sys.argv) != 2:
        sys.stderr.write('error: argument error\n'
                         'usage: %s <cfg_file>\n\n')
        raise RuntimeError('argument error: %s' % sys.argv)

    # ensure we have a config file
    cfg = ru.read_json(sys.argv[1])

    pwd = cfg['pwd']
    uid = cfg['uid']

    # first things first: inform the caller about our pit
    spt.setproctitle('rp.%s' % uid)
    with open('%s/%s.pid'  % (pwd, uid), 'w') as fout:
        fout.write('%d\n' % os.getpid())
        fout.flush

    # create the component
    comp  = rpu.Component.create(cfg)
    comp.start()
    comp.wait()


# ------------------------------------------------------------------------------

